<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta charset="UTF-8">
    <title>客房预订</title>
    <link rel="stylesheet" href="../public/jquery-weui/1.0/weui.min.css">
    <link rel="stylesheet" href="../public/jquery-weui/1.0/jquery-weui.min.css">
    <link rel="stylesheet" href="../public/css/swiper-3.3.1.min.css">
    <link rel="stylesheet" href="../css/reservation.min.css">
</head>
<body>
<div class="main">
<div class="t-nav">
    <a href="javascript:;" class="left" v-if="status>0" v-on:click="status = --status">
        <i class="iconfont icon-left"></i>
    </a>

    <div class="title">客房预订</div>
    <!--<div class="right" v-if="status==1" v-on:click="addPostcard">{{ (status==1)?('完成'):('') }}</div>-->
</div>

<div class="status0" v-if="status==0">
    <div class="swiper-container barn">
        <div class="swiper-wrapper">
            <div class="swiper-slide" v-for="(photo,i) in photos">
                <img :src="photo['src']" :alt="photo['alt']">
            </div>
        </div>
        <div class="swiper-pagination"></div>
    </div>

    <div class="weui-cells weui-cells_form trip-cells_form" style="margin-top:0;">
        <div class="weui-cell weui-cell_vcode pub-date">
            <div class="weui-cell__bd">
                <input class="weui-input" id="date" type="text" value="" readonly="" placeholder="选择入住日期">
            </div>
            <div class="weui-cell__bd">
                <input class="weui-input" id="date2" type="text" value="" readonly="" placeholder="选择离开日期">
            </div>
            <div class="weui-cell__ft">
                <button class="weui-vcode-btn">查询</button>
            </div>
        </div>
    </div>

    <div class="weui-panel weui-panel_access trip-cells_form">
        <div class="weui-panel__hd" id="fold0" v-on:click="funcFold">客房情况</div>
        <div class="weui-panel__bd">
            <div class="weui-media-box weui-media-box_appmsg" v-for="(item,i) in roomData">
                <div class="weui-media-box__hd">
                    <img class="weui-media-box__thumb"
                         src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAAAeFBMVEUAwAD///+U5ZTc9twOww7G8MYwzDCH4YcfyR9x23Hw+/DY9dhm2WZG0kbT9NP0/PTL8sux7LFe115T1VM+zz7i+OIXxhes6qxr2mvA8MCe6J6M4oz6/frr+us5zjn2/fa67rqB4IF13XWn6ad83nxa1loqyirn+eccHxx4AAAC/klEQVRo3u2W2ZKiQBBF8wpCNSCyLwri7v//4bRIFVXoTBBB+DAReV5sG6lTXDITiGEYhmEYhmEYhmEYhmEY5v9i5fsZGRx9PyGDne8f6K9cfd+mKXe1yNG/0CcqYE86AkBMBh66f20deBc7wA/1WFiTwvSEpBMA2JJOBsSLxe/4QEEaJRrASP8EVF8Q74GbmevKg0saa0B8QbwBdjRyADYxIhqxAZ++IKYtciPXLQVG+imw+oo4Bu56rjEJ4GYsvPmKOAB+xlz7L5aevqUXuePWVhvWJ4eWiwUQ67mK51qPj4dFDMlRLBZTqF3SDvmr4BwtkECu5gHWPkmDfQh02WLxXuvbvC8ku8F57GsI5e0CmUwLz1kq3kD17R1In5816rGvQ5VMk5FEtIiWislTffuDpl/k/PzscdQsv8r9qWq4LRWX6tQYtTxvI3XyrwdyQxChXioOngH3dLgOFjk0all56XRi/wDFQrGQU3Os5t0wJu1GNtNKHdPqYaGYQuRDfbfDf26AGLYSyGS3ZAK4S8XuoAlxGSdYMKwqZKM9XJMtyqXi7HX/CiAZS6d8bSVUz5J36mEMFDTlAFQzxOT1dzLRljjB6+++ejFqka+mXIe6F59mw22OuOw1F4T6lg/9VjL1rLDoI9Xzl1MSYDNHnPQnt3D1EE7PrXjye/3pVpr1Z45hMUdcACc5NVQI0bOdS1WA0wuz73e7/5TNqBPhQXPEFGJNV2zNqWI7QKBd2Gn6AiBko02zuAOXeWIXjV0jNqdKegaE/kJQ6Bfs4aju04lMLkA2T5wBSYPKDGF3RKhFYEa6A1L1LG2yacmsaZ6YPOSAMKNsO+N5dNTfkc5Aqe26uxHpx7ZirvgCwJpWq/lmX1hA7LyabQ34tt5RiJKXSwQ+0KU0V5xg+hZrd4Bn1n4EID+WkQdgLfRNtvil9SPfwy+WQ7PFBWQz6dGWZBLkeJFXZGCfLUjCgGgqXo5TuSu3cugdcTv/HjqnBTEMwzAMwzAMwzAMwzAMw/zf/AFbXiOA6frlMAAAAABJRU5ErkJggg=="
                         alt="">
                </div>
                <div class="weui-media-box__bd">
                    <h4 class="weui-media-box__title">{{item.name}}</h4>

                    <p class="weui-media-box__desc">
                        价格：¥<span class="money f16">{{item.price}}</span>剩 <span class="f16">{{item.stock}}</span> 房
                    </p>

                    <p class="weui-media-box__desc">
                        <span class="service f12" v-for="service in item.services">{{service}}</span>
                    </p>
                </div>
                <div class="book" :class="{no:item.stock<=0}" v-on:click="book(item)">预订</div>
            </div>
        </div>
    </div>

    <div class="fold" id="fold1">
        <div class="weui-panel__hd" v-on:click="funcFold">旅舍概况</div>
        <article class="weui-article hotel-overview hide">
            <h1>旅舍概况</h1>

            <p>
                泉州一束光青年旅舍位于泉州学府路，泉州第一中学附近，从梅石书院旧址的大榕树进入梅石巷内大约两百米。
                从旅舍步行大约5分钟可到朝天门，骑自行车（15分钟）或乘坐15路/K1直达清源山国家重点风景名胜区游览
            </p>

            <h1>景点游览</h1>

            <p> 至东湖公园：骑行10分钟；公交15路/1路泉州一中上，东门下</p>

            <p> 至西湖公园：骑行15分钟；公交21路/17路，北门街上，西湖公园下</p>

            <p> 至钟楼&西街：骑行10分钟；公交1路，泉州一中上（海星小区方向），钟楼下；2路/17路/40路，北门街上，钟楼下</p>

            <p> 至开元寺：骑行10分钟，公交40路，北门街上（新塘、尚好家园方向），开元寺西门下</p>

            <p> 至关帝庙：骑行10分钟；公交X1，泉州一中上，九一街下</p>

            <p> 至天后宫：骑行20分钟；公交21路，北门街上，义全街口下</p>

            <p> 至闽台缘博物馆：骑行10分钟；公交15路，泉州一中上，泉山路南段下</p>

            <p> 至源和1916：骑行15分钟；公交40路，北门街上，蔬菜公司下</p>
        </article>
    </div>

    <div class="fold" id="fold2">
        <div class="weui-panel__hd" v-on:click="funcFold">交通指引</div>
        <article class="weui-article hotel-overview hide">
            <h1>1.机场：距离晋江机场14.5公里</h1>

            <p>（1）乘坐K603，到承天寺下，同站换乘X1（福厦高铁泉州站方向），在学府街西段下（PS.X1公交车随叫随停，可告知司机在梅石书院旧址下），到一束光青年旅舍</p>

            <p>（2）乘坐K603，到钟楼下，换乘1路公交车（外国语中学方向），在学府街西段下，到一束光青年旅舍</p>

            <p>（3）在机场路口可乘坐K604，东南医院下，换乘15路公交车（清源山风景区方向），在学府街西段下，到一束光青年旅舍</p>

            <p>（4）在机场路口可乘坐K604，公路一公司下，同站换乘1路公交车（外国语中学方向），在学府街西段下，到一束光青年旅舍</p>

            <p>（5）出租车：约40分钟，费用约50元</p>

            <h1>2.泉州动车站：距离动车站7.6公里</h1>

            <p>（1）乘坐X1，在学府街西段下（PS.X1公交车随叫随停，可告知司机在梅石书院旧址下）</p>

            <p>（2）乘坐K1/3路，在普明村下，步行约8分钟到一束光青年旅舍</p>

            <p>（3）乘坐2/17路，在朝天门下，步行约10分钟到一束光青年旅舍</p>

            <p>（4）出租车：约20分钟，费用约25元</p>

            <h1>3.市区</h1>

            <p>市内可乘坐1路、15路、22路、37路、X1路公交车，在学府街西段下，到一束光青年旅舍</p>

            <h1>4.自行车，自便~</h1>
        </article>
    </div>

    <div class="fold" id="fold3">
        <div class="weui-panel__hd" v-on:click="funcFold">可提供的服务</div>
        <article class="weui-article hotel-overview hide">
            <h1>旅舍概况</h1>

            <p>无线WiFi、餐厅、24小时热水洗浴、自助洗衣、行李寄存、贵重物品存放、24小时前台服务、免费旅游咨询服务、茶室、书吧、咖啡饮料甜点、电吹风等</p>
        </article>
    </div>
</div>

<div id="book-div" v-if="status==1">
    <div class="weui-panel weui-panel_access trip-cells_form">
        <div class="weui-panel__bd">
            <div class="weui-media-box weui-media-box_text">
                <h4 class="weui-media-box__title">入住时间</h4>

                <p class="weui-media-box__desc"><span class="start_date">2017-04-29</span>入住 - <span class="end_date">2017-04-30</span>离店
                </p>
            </div>
            <div class="weui-media-box weui-media-box_text">
                <h4 class="weui-media-box__title name">客舍名称</h4>

                <p class="weui-media-box__desc">壹束光青年旅舍</p>
            </div>
            <div class="weui-media-box weui-media-box_text">
                <h4 class="weui-media-box__title">房间类型</h4>

                <p class="weui-media-box__desc product_name">混住多人间床位（公共卫生间）</p>
            </div>
        </div>
    </div>
    <div class="weui-cells weui-cells_form trip-cells_form">
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">会员价数量</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入您需要预定的数量">
            </div>
        </div>
    </div>
    <div class="weui-cells weui-cells_form trip-cells_form">
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">预订人姓名</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="text" placeholder="请输入预订人姓名">
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">手机号码</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入联系人手机号码">
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">电子邮箱</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="email" placeholder="请输入电子邮箱">
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">入住（男）</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入入住的男性人数">
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">入住（女）</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入入住的女性人数">
            </div>
        </div>
    </div>
    <div class="weui-cells__tips f12">温馨提示：入住当天，旅舍为您保留床位|房间的时限为入住当日的6:00 至 18:00
        。如果您因事情延误，在最晚到店时间前无法赶到旅舍办理入住手续的，请注意通知旅舍为您保留预订房间，以免床位⁄房间被重新安排。
    </div>
    <div class="weui-btn-area">
        <a class="weui-btn weui-btn_primary" href="javascript:" v-on:click="next">下一步</a>
    </div>
</div>

<div v-if="status==2">
    <div class="weui-cells__title">预订信息</div>
    <div class="weui-cells trip-cells_form status2">
        <div class="weui-cell">
            <div class="weui-cell__ft">入住时间</div>
            <div class="weui-cell__bd">
                <p>2017/04/26 至 2017/04/29 </p>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__ft">入住晚数</div>
            <div class="weui-cell__bd">
                <p>3 晚</p>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__ft">预订旅舍</div>
            <div class="weui-cell__bd">
                <p>[泉州]一束光青年旅舍</p>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__ft">房间类型</div>
            <div class="weui-cell__bd">
                <p>三人间</p>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__ft">床位数量</div>
            <div class="weui-cell__bd">
                <p>2床</p>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__ft">你共订了</div>
            <div class="weui-cell__bd">
                <p>2房</p>
            </div>
        </div>
    </div>

    <div class="weui-cells__title">入住资料</div>
    <div class="weui-cells trip-cells_form status2">
        <div class="weui-cell">
            <div class="weui-cell__ft">入住姓名</div>
            <div class="weui-cell__bd">
                <p>邱永劲</p>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__ft">手机号码</div>
            <div class="weui-cell__bd">
                <p>15218288177</p>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__ft">电子邮箱</div>
            <div class="weui-cell__bd">
                <p>qiu5630@163.com</p>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__ft">入住人数</div>
            <div class="weui-cell__bd">
                <p>1</p>
            </div>
        </div>
    </div>

    <div class="weui-cells__title">付款详情</div>
    <div class="weui-cells trip-cells_form status2">
        <div class="weui-cell">
            <div class="weui-cell__ft">订单总额</div>
            <div class="weui-cell__bd">
                <p>1000 元</p>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__ft">到前台支付</div>
            <div class="weui-cell__bd">
                <p>500</p>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__ft">电子邮箱</div>
            <div class="weui-cell__bd">
                <p>qiu5630@163.com</p>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__ft" style="width: 200px;">现在需要支付的预订服务费</div>
            <div class="weui-cell__bd">
                <p>300 元</p>
            </div>
        </div>
    </div>

    <div class="weui-cells__title">支付方式</div>
    <div class="weui-btn-area" style="margin-top: 8px;">
        <a class="weui-btn weui-btn_primary" href="javascript:" v-on:click="next">支付宝</a>
    </div>
    <div class="weui-btn-area">
        <a class="weui-btn weui-btn_primary" href="javascript:" v-on:click="next">微信</a>
    </div>
</div>

<div class="weui-loadmore weui-loadmore_line">
    <span class="weui-loadmore__tips">壹束光青年旅舍</span>
</div>
</div>
</body>
<script type="text/javascript" src="../public/js/jquery-2.1.4.js"></script>
<script type="text/javascript" src="../public/js/swiper-3.3.1.jquery.min.js"></script>
<script type="text/javascript" src="../public/js/vue.min.js"></script>
<script type="text/javascript" src="../public/jquery-weui/1.0/jquery-weui.min.js"></script>

<script type="text/javascript" src="../js/android.js"></script>
<script type="text/javascript" src="../public/js/md5.js"></script>
<script type="text/javascript" src="../public/js/underscore.js"></script>
<script type="text/javascript" src="../js/api.js"></script>

<script type="text/javascript">
    var page_size = 10;
    var group_id = U.ajax.getUrlParam("group_id");
    var sort = U.ajax.getUrlParam('sort') || 'asc';

    jQuery(function($){
        function loadRoomData(query, callback){
            if(!callback){
                callback = query;
                query = {
                    "group_id": group_id,
                    "page": 1,
                    'sort': sort,
                    "psize": page_size
                };
            }

            query['group_id'] = group_id;

            U.api.checkpoint.list(query, function(err, json){
                if(err){
                    android.alert(err.message);
                }else{
                    var photos = [];
                    var roomData = [
                        {
                            id: 0,
                            name: '女生四人间',
                            price: 45,
                            stock: 2, // 剩下房间
                            services: ['wifi', '空调', '独卫']
                        },
                        {
                            id: 1,
                            name: '男生六人间',
                            price: 45,
                            stock: 0,
                            services: ['wifi', '空调', '独卫']
                        },
                        {
                            id: 2,
                            name: '女生六人间',
                            price: 40,
                            stock: 4,
                            services: ['wifi', '空调']
                        },
                        {
                            id: 3,
                            name: '男生八人间',
                            price: 40,
                            stock: 3,
                            services: ['wifi', '空调', '独卫']
                        }
                    ];
                    if(json && json.length){
                        _.each(json, function(v, k, arr){
                            photos.push({
                                'src': U.api.oss.rid2url(v['photo'], 'style/index_bar_photo'),
                                'alt': v['mark']
                            })
                        });

                        callback({
                            status: 0,
                            photos: photos,
                            roomData: roomData
                        })
                    }
                    // callBack(err, json, query);
                }

            });


        }

        // Vue.config.devtools = true;

        loadRoomData(function(data){
            new Vue({
                el: '.main',
                data: data,
                created: function(){
                },
                methods: {
                    funcBack: function(){
                        (this.status == 1) ? this.status = 0 : window.history.back();
                    },
                    book: function(item){
                        // 预订
                        if(item.stock > 0){
                            var $main = $('#book-div');
                            $main.find("span.start_date").text('');
                            $main.find("span.end_date").text('');
                            $main.find("p.product_name").text(item['name']);
                            this.status = 1;
                        }else{
                            $.alert("产品已经售完");
                        }
                    },
                    next: function(){
                        this.status = 2;
                    },
                    funcFold: function(e){
                        $(e.target).next().toggle();
                    }
                }
            });

            $("#date,#date2").calendar({
                minDate: Date.parse(new Date().toString()),
                onClose: function(p){
                    console.log(p.value[0]);
                }
            });

            $(".barn").swiper({
                loop: false,
                autoplay: 2000,//可选选项，自动滑动
                pagination: '.swiper-pagination',// 分页
                autoHeight: true, //高度随内容变化
                autoplayDisableOnInteraction: false// 点击后继续滑动
            });

        });
    });
</script>
</html>